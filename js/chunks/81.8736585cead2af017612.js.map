{"version":3,"file":"js/chunks/81.8736585cead2af017612.js","mappings":"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","sources":["webpack://toilet-review-system-frontend/./src/pages/review/review.page.js","webpack://toilet-review-system-frontend/./src/core/constants/api.constants.js"],"sourcesContent":["/**\n * Review Page Component\n * Handles QR code scanning and review submission functionality\n */\n\nimport { BasePage } from '../shared/page.base.js';\nimport appStore from '../../state/store/app.store.js';\nimport { toiletApiService } from '../../services/api/toilet-api.service.js';\nimport { reviewApiService } from '../../services/api/review-api.service.js';\nimport { $ } from '../../core/utils/dom.utils.js';\n\n/**\n * ReviewPage Class\n * Handles QR code scanning and review submission functionality\n */\nexport class ReviewPage extends BasePage {\n    constructor() {\n        super();\n        this.currentToiletId = null;\n        this.qrReader = null;\n    }\n\n    /**\n     * Initialize the review page\n     */\n    async init() {\n        console.log('[ReviewPage] Initializing review page...');\n\n        try {\n            // Set up loading states\n            this.setupLoadingStates();\n\n            // Initialize QR scanner\n            this.initializeQRScanner();\n\n            // Set up form handlers\n            this.setupFormHandlers();\n\n            console.log('[ReviewPage] Review page initialized successfully');\n\n        } catch (error) {\n            console.error('[ReviewPage] Error initializing review page:', error);\n            this.showError('Failed to initialize review page. Please refresh and try again.');\n        }\n    }\n\n    /**\n     * Set up loading states for the page\n     */\n    setupLoadingStates() {\n        const loadingOverlay = document.getElementById('reviewLoading');\n        if (loadingOverlay) {\n            // Hide loading overlay after a short delay\n            setTimeout(() => {\n                loadingOverlay.classList.add('hidden');\n            }, 500);\n        }\n    }\n\n    /**\n     * Initialize QR code scanner\n     */\n    async initializeQRScanner() {\n        console.log('[ReviewPage] Initializing QR scanner...');\n\n        const qrReaderSection = document.getElementById('qr-reader-section');\n        const qrReader = document.getElementById('qr-reader');\n\n        if (!qrReader) {\n            console.warn('[ReviewPage] QR reader element not found');\n            return;\n        }\n\n        try {\n            // Check if Html5Qrcode is available\n            if (typeof Html5Qrcode === 'undefined') {\n                throw new Error('QR scanner library not loaded');\n            }\n\n            // Initialize QR scanner\n            this.qrReader = new Html5Qrcode('qr-reader', {\n                fps: 10,\n                qrbox: { width: 250, height: 250 },\n                aspectRatio: 1.0\n            });\n\n            // Start scanning\n            await this.qrReader.start(\n                { facingMode: 'environment' }, // Use back camera\n                {\n                    fps: 10,\n                    qrbox: { width: 250, height: 250 }\n                },\n                this.onQRCodeScanned.bind(this),\n                this.onQRScanError.bind(this)\n            );\n\n            console.log('[ReviewPage] QR scanner initialized successfully');\n\n        } catch (error) {\n            console.error('[ReviewPage] Error initializing QR scanner:', error);\n            this.showScannerError('Failed to initialize camera. Please ensure camera permissions are granted.');\n        }\n    }\n\n    /**\n     * Handle successful QR code scan\n     */\n    async onQRCodeScanned(decodedText, decodedResult) {\n        console.log('[ReviewPage] QR code scanned:', decodedText);\n\n        try {\n            // Stop scanning\n            if (this.qrReader) {\n                await this.qrReader.stop();\n                this.qrReader = null;\n            }\n\n            // Hide scanner section\n            const qrReaderSection = document.getElementById('qr-reader-section');\n            if (qrReaderSection) {\n                qrReaderSection.style.display = 'none';\n            }\n\n            // Process the scanned data\n            await this.processScannedData(decodedText);\n\n        } catch (error) {\n            console.error('[ReviewPage] Error processing QR code:', error);\n            this.showError('Failed to process QR code. Please try again.');\n            this.resetScanner();\n        }\n    }\n\n    /**\n     * Handle QR scan errors\n     */\n    onQRScanError(error) {\n        // Only log significant errors, not \"No QR code found\"\n        if (error && !error.includes('No QR code found')) {\n            console.warn('[ReviewPage] QR scan error:', error);\n        }\n    }\n\n    /**\n     * Process scanned QR code data\n     */\n    async processScannedData(scannedData) {\n        console.log('[ReviewPage] Processing scanned data:', scannedData);\n\n        try {\n            let toiletId = null;\n\n            // Check if it's a review URL\n            if (scannedData.includes('review.html?id=')) {\n                const url = new URL(scannedData);\n                toiletId = url.searchParams.get('id');\n            } else {\n                // Treat as direct toilet ID\n                toiletId = scannedData.trim();\n            }\n\n            if (!toiletId) {\n                throw new Error('Invalid QR code format - no toilet ID found');\n            }\n\n            // Load toilet information\n            await this.loadToiletInfo(toiletId);\n\n        } catch (error) {\n            console.error('[ReviewPage] Error processing scanned data:', error);\n            this.showError('Invalid QR code. Please scan a valid toilet QR code.');\n            this.resetScanner();\n        }\n    }\n\n    /**\n     * Load toilet information for review\n     */\n    async loadToiletInfo(toiletId) {\n        console.log('[ReviewPage] Loading toilet info for ID:', toiletId);\n\n        const toiletInfo = document.getElementById('toiletInfo');\n        if (!toiletInfo) return;\n\n        try {\n            // Show loading state\n            toiletInfo.innerHTML = `\n                <div class=\"toilet-info__loading\" role=\"status\" aria-live=\"polite\">\n                    <div class=\"loading-spinner\" aria-hidden=\"true\"></div>\n                    <p>Loading toilet information...</p>\n                </div>\n            `;\n            toiletInfo.style.display = 'block';\n\n            // Fetch toilet data\n            const toilet = await this.toiletApiService.getToiletById(toiletId);\n\n            if (!toilet) {\n                throw new Error('Toilet not found');\n            }\n\n            // Store current toilet ID\n            this.currentToiletId = toiletId;\n\n            // Display toilet information\n            this.displayToiletInfo(toilet);\n\n            // Show review form\n            const reviewFormSection = document.getElementById('reviewFormSection');\n            if (reviewFormSection) {\n                reviewFormSection.style.display = 'block';\n            }\n\n        } catch (error) {\n            console.error('[ReviewPage] Error loading toilet info:', error);\n            toiletInfo.innerHTML = `\n                <div class=\"toilet-info__error\" role=\"alert\">\n                    <h3>Error Loading Toilet Information</h3>\n                    <p>${error.message}</p>\n                    <button onclick=\"window.location.reload()\" class=\"btn btn-primary\">Try Again</button>\n                </div>\n            `;\n        }\n    }\n\n    /**\n     * Display toilet information\n     */\n    displayToiletInfo(toilet) {\n        const toiletInfo = document.getElementById('toiletInfo');\n\n        const facilitiesHtml = toilet.facilities && toilet.facilities.length > 0\n            ? toilet.facilities.map(facility =>\n                `<span class=\"toilet-info__facility\">${facility.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}</span>`\n            ).join('')\n            : '<span class=\"toilet-info__facility\">No facilities listed</span>';\n\n        toiletInfo.innerHTML = `\n            <h2 class=\"toilet-info__title\">Toilet Information</h2>\n            <div class=\"toilet-info__content\">\n                <div class=\"toilet-info__group\">\n                    <h3 class=\"toilet-info__value\">${toilet.name || 'Unnamed Toilet'}</h3>\n                    <p class=\"toilet-info__value\">${toilet.location || 'Location not specified'}</p>\n                </div>\n                <div class=\"toilet-info__group\">\n                    <h4 class=\"toilet-info__label\">Current Rating</h4>\n                    <p class=\"toilet-info__rating\">${toilet.averageRating ? `${toilet.averageRating.toFixed(1)} ‚≠ê` : 'No ratings yet'}</p>\n                    <p class=\"toilet-info__value\">${toilet.totalReviews || 0} reviews</p>\n                </div>\n                <div class=\"toilet-info__group\">\n                    <h4 class=\"toilet-info__label\">Facilities</h4>\n                    <div class=\"toilet-info__facilities\">${facilitiesHtml}</div>\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Set up form event handlers\n     */\n    setupFormHandlers() {\n        const reviewForm = document.getElementById('reviewForm');\n        const scanNewQRBtn = document.getElementById('scanNewQR');\n\n        if (reviewForm) {\n            reviewForm.addEventListener('submit', this.handleReviewSubmit.bind(this));\n        }\n\n        if (scanNewQRBtn) {\n            scanNewQRBtn.addEventListener('click', this.resetScanner.bind(this));\n        }\n    }\n\n    /**\n     * Handle review form submission\n     */\n    async handleReviewSubmit(event) {\n        event.preventDefault();\n\n        if (!this.currentToiletId) {\n            this.showError('No toilet selected. Please scan a QR code first.');\n            return;\n        }\n\n        const submitBtn = event.target.querySelector('button[type=\"submit\"]');\n        this.setButtonLoading(submitBtn, true);\n\n        try {\n            // Collect form data\n            const formData = new FormData(event.target);\n            const reviewData = {\n                toiletId: this.currentToiletId,\n                rating: parseInt(formData.get('rating')),\n                cleanliness: parseInt(formData.get('cleanliness')),\n                maintenance: parseInt(formData.get('maintenance')),\n                accessibility: parseInt(formData.get('accessibility')),\n                comment: formData.get('comments')?.trim() || ''\n            };\n\n            // Validate required fields\n            if (!reviewData.rating || !reviewData.cleanliness || !reviewData.maintenance || !reviewData.accessibility) {\n                throw new Error('Please fill in all required rating fields');\n            }\n\n            console.log('[ReviewPage] Submitting review:', reviewData);\n\n            // Submit review\n            await this.reviewApiService.submitReview(reviewData);\n\n            // Show success message\n            this.showSuccess();\n\n        } catch (error) {\n            console.error('[ReviewPage] Error submitting review:', error);\n            this.showError(error.message || 'Failed to submit review. Please try again.');\n        } finally {\n            this.setButtonLoading(submitBtn, false);\n        }\n    }\n\n    /**\n     * Show success message\n     */\n    showSuccess() {\n        // Hide form sections\n        const toiletInfo = document.getElementById('toiletInfo');\n        const reviewFormSection = document.getElementById('reviewFormSection');\n\n        if (toiletInfo) toiletInfo.style.display = 'none';\n        if (reviewFormSection) reviewFormSection.style.display = 'none';\n\n        // Show success message\n        const successMessage = document.getElementById('successMessage');\n        if (successMessage) {\n            successMessage.style.display = 'block';\n\n            // Create confetti effect\n            this.createConfetti();\n        }\n    }\n\n    /**\n     * Show error message\n     */\n    showError(message) {\n        // Simple alert for now - could be enhanced with a proper error UI\n        alert(`Error: ${message}`);\n    }\n\n    /**\n     * Show scanner error\n     */\n    showScannerError(message) {\n        const qrReaderSection = document.getElementById('qr-reader-section');\n        if (qrReaderSection) {\n            qrReaderSection.innerHTML = `\n                <div class=\"scanner-section__error\" role=\"alert\">\n                    <h2 class=\"scanner-section__title\">Camera Error</h2>\n                    <p>${message}</p>\n                    <button onclick=\"window.location.reload()\" class=\"btn btn-primary\">Retry</button>\n                </div>\n            `;\n        }\n    }\n\n    /**\n     * Reset scanner to initial state\n     */\n    resetScanner() {\n        console.log('[ReviewPage] Resetting scanner...');\n\n        // Stop current scanner\n        if (this.qrReader) {\n            this.qrReader.stop().catch(console.error);\n            this.qrReader = null;\n        }\n\n        // Hide all sections\n        const sections = ['toiletInfo', 'reviewFormSection', 'successMessage'];\n        sections.forEach(sectionId => {\n            const element = document.getElementById(sectionId);\n            if (element) element.style.display = 'none';\n        });\n\n        // Reset form\n        const reviewForm = document.getElementById('reviewForm');\n        if (reviewForm) reviewForm.reset();\n\n        // Show scanner section\n        const qrReaderSection = document.getElementById('qr-reader-section');\n        if (qrReaderSection) {\n            qrReaderSection.style.display = 'block';\n            qrReaderSection.innerHTML = `\n                <h2 class=\"scanner-section__title\">Scan QR Code</h2>\n                <div id=\"qr-reader\" class=\"scanner-section__reader\" role=\"application\" aria-label=\"QR code scanner\"></div>\n                <div class=\"scanner-section__instructions\">\n                    <h3 class=\"scanner-section__instructions-title\">How to Scan</h3>\n                    <p class=\"scanner-section__instructions-text\">Point your camera at the toilet's QR code to begin your review.</p>\n                </div>\n            `;\n\n            // Reinitialize scanner\n            setTimeout(() => this.initializeQRScanner(), 100);\n        }\n\n        // Reset current toilet ID\n        this.currentToiletId = null;\n    }\n\n    /**\n     * Create confetti effect for success\n     */\n    createConfetti() {\n        const confettiContainer = document.getElementById('confettiContainer') || document.createElement('div');\n        confettiContainer.id = 'confettiContainer';\n        confettiContainer.className = 'confetti-container';\n\n        const colors = ['#ff69b4', '#ffd700', '#00ff00', '#ff0000', '#0000ff'];\n\n        for (let i = 0; i < 50; i++) {\n            const confetti = document.createElement('div');\n            confetti.style.cssText = `\n                position: absolute;\n                width: 10px;\n                height: 10px;\n                background-color: ${colors[Math.floor(Math.random() * colors.length)]};\n                left: ${Math.random() * 100}%;\n                animation: fall ${3 + Math.random() * 2}s linear forwards;\n                z-index: 1000;\n            `;\n\n            confettiContainer.appendChild(confetti);\n\n            // Remove confetti after animation\n            setTimeout(() => {\n                if (confetti.parentNode) {\n                    confetti.parentNode.removeChild(confetti);\n                }\n            }, 5000);\n        }\n\n        const successMessage = document.getElementById('successMessage');\n        if (successMessage && !successMessage.contains(confettiContainer)) {\n            successMessage.appendChild(confettiContainer);\n        }\n    }\n\n    /**\n     * Set button loading state\n     */\n    setButtonLoading(button, loading) {\n        if (!button) return;\n\n        button.disabled = loading;\n        button.textContent = loading ? 'Submitting...' : 'Submit Review';\n\n        if (loading) {\n            button.classList.add('loading');\n        } else {\n            button.classList.remove('loading');\n        }\n    }\n\n    /**\n     * Cleanup when page is destroyed\n     */\n    destroy() {\n        console.log('[ReviewPage] Destroying review page...');\n\n        // Stop QR scanner\n        if (this.qrReader) {\n            this.qrReader.stop().catch(console.error);\n            this.qrReader = null;\n        }\n\n        // Clear current toilet ID\n        this.currentToiletId = null;\n\n        console.log('[ReviewPage] Review page destroyed');\n    }\n}\n","/**\n * API Constants\n * Centralizes all API-related constants\n * Follows DRY principle - single source of truth for API paths and settings\n */\n\nexport const API_ENDPOINTS = {\n    // Toilet endpoints\n    TOILETS: {\n        MAP: 'toilet/map',\n        STATS: 'toilet/stats',\n        ADD_PRIVATE: 'toilet/add-private',\n        SYNC_PUBLIC: 'toilet/sync-public',\n        BY_ID: (id) => `toilet/${id}`,\n        QR_CODE: (id) => `toilet/${id}/qr`\n    },\n\n    // Review endpoints\n    REVIEWS: {\n        SUBMIT: 'review/submit',\n        ALL: 'review/all',\n        BY_TOILET: (toiletId) => `review/toilet/${toiletId}`,\n        BY_ID: (id) => `reviews/${id}`\n    },\n\n    // Authentication endpoints\n    AUTH: {\n        LOGIN: 'auth/login',\n        REGISTER: 'auth/register',\n        LOGOUT: 'auth/logout',\n        ME: 'auth/me'\n    },\n\n    // Admin endpoints\n    ADMIN: {\n        LOGIN: 'admin/login',\n        DASHBOARD: 'admin/dashboard',\n        STATS: 'admin/stats'\n    },\n\n    // System endpoints\n    SYSTEM: {\n        SLO_METRICS: 'slo/metrics',\n        CACHE_STATS: 'cache/stats',\n        CACHE_INVALIDATE: 'cache/invalidate'\n    }\n};\n\nexport const HTTP_STATUS = {\n    OK: 200,\n    CREATED: 201,\n    NO_CONTENT: 204,\n    BAD_REQUEST: 400,\n    UNAUTHORIZED: 401,\n    FORBIDDEN: 403,\n    NOT_FOUND: 404,\n    CONFLICT: 409,\n    TOO_MANY_REQUESTS: 429,\n    INTERNAL_SERVER_ERROR: 500,\n    SERVICE_UNAVAILABLE: 503\n};\n\nexport const HTTP_METHODS = {\n    GET: 'GET',\n    POST: 'POST',\n    PUT: 'PUT',\n    DELETE: 'DELETE',\n    PATCH: 'PATCH'\n};\n\nexport const CONTENT_TYPES = {\n    JSON: 'application/json',\n    FORM_DATA: 'multipart/form-data',\n    TEXT: 'text/plain',\n    HTML: 'text/html'\n};\n\nexport const CACHE_KEYS = {\n    TOILETS: 'toilets',\n    REVIEWS: 'reviews',\n    STATS: 'stats',\n    USER: 'user'\n};\n\nexport const API_ERRORS = {\n    NETWORK_ERROR: 'Network request failed',\n    TIMEOUT_ERROR: 'Request timed out',\n    PARSE_ERROR: 'Failed to parse response',\n    AUTH_ERROR: 'Authentication required',\n    PERMISSION_ERROR: 'Insufficient permissions',\n    NOT_FOUND: 'Resource not found',\n    SERVER_ERROR: 'Server error occurred'\n};\n"],"names":["ReviewPage","_BasePage","_this","_classCallCheck","_callSuper","currentToiletId","qrReader","_inherits","_createClass","key","value","_init","_asyncToGenerator","_regeneratorRuntime","_callee","_context","prev","next","this","setupLoadingStates","initializeQRScanner","setupFormHandlers","error","showError","stop","apply","arguments","loadingOverlay","document","getElementById","setTimeout","classList","add","_initializeQRScanner","_callee2","_context2","abrupt","Html5Qrcode","Error","fps","qrbox","width","height","aspectRatio","start","facingMode","onQRCodeScanned","bind","onQRScanError","showScannerError","_onQRCodeScanned","_callee3","decodedText","decodedResult","qrReaderSection","_context3","style","display","processScannedData","resetScanner","_x","_x2","includes","_processScannedData","_callee4","scannedData","toiletId","url","_context4","URL","searchParams","get","trim","loadToiletInfo","_x3","_loadToiletInfo","_callee5","toiletInfo","toilet","reviewFormSection","_t4","_context5","innerHTML","toiletApiService","getToiletById","sent","displayToiletInfo","concat","message","_x4","facilitiesHtml","facilities","length","map","facility","replace","l","toUpperCase","join","name","location","averageRating","toFixed","totalReviews","reviewForm","scanNewQRBtn","addEventListener","handleReviewSubmit","_handleReviewSubmit","_callee6","event","submitBtn","_formData$get","formData","reviewData","_t5","_context6","preventDefault","target","querySelector","setButtonLoading","FormData","rating","parseInt","cleanliness","maintenance","accessibility","comment","reviewApiService","submitReview","showSuccess","finish","_x5","successMessage","createConfetti","alert","_this2","catch","console","forEach","sectionId","element","reset","confettiContainer","createElement","id","className","colors","_loop","confetti","cssText","Math","floor","random","appendChild","parentNode","removeChild","i","contains","button","loading","disabled","textContent","remove","BasePage","API_ENDPOINTS","TOILETS","MAP","STATS","ADD_PRIVATE","SYNC_PUBLIC","BY_ID","QR_CODE","REVIEWS","SUBMIT","ALL","BY_TOILET","AUTH","LOGIN","REGISTER","LOGOUT","ME","ADMIN","DASHBOARD","SYSTEM","SLO_METRICS","CACHE_STATS","CACHE_INVALIDATE"],"ignoreList":[],"sourceRoot":""}