"use strict";(self.webpackChunktoilet_review_system_frontend=self.webpackChunktoilet_review_system_frontend||[]).push([[81],{376(e,t,n){n.r(t),n.d(t,{ReviewPage:()=>f});var i=n(848),r=n(29),a=n(901),o=n(388),s=n(954),c=n(361),l=n(756),d=n(758);n(851),n(438),n(567),n(134);function u(e,t,n){return t=(0,s.A)(t),(0,o.A)(e,h()?Reflect.construct(t,n||[],(0,s.A)(e).constructor):t.apply(e,n))}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(h=function(){return!!e})()}var f=function(e){function t(){var e;return(0,r.A)(this,t),(e=u(this,t)).currentToiletId=null,e.qrReader=null,e}return(0,c.A)(t,e),(0,a.A)(t,[{key:"init",value:(f=(0,i.A)(l.mark(function e(){return l.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{this.setupLoadingStates(),this.initializeQRScanner(),this.setupFormHandlers()}catch(e){this.showError("Failed to initialize review page. Please refresh and try again.")}case 1:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"setupLoadingStates",value:function(){var e=document.getElementById("reviewLoading");e&&setTimeout(function(){e.classList.add("hidden")},500)}},{key:"initializeQRScanner",value:(h=(0,i.A)(l.mark(function e(){return l.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(document.getElementById("qr-reader-section"),document.getElementById("qr-reader")){e.next=1;break}return e.abrupt("return");case 1:if(e.prev=1,"undefined"!=typeof Html5Qrcode){e.next=2;break}throw new Error("QR scanner library not loaded");case 2:return this.qrReader=new Html5Qrcode("qr-reader",{fps:10,qrbox:{width:250,height:250},aspectRatio:1}),e.next=3,this.qrReader.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},this.onQRCodeScanned.bind(this),this.onQRScanError.bind(this));case 3:e.next=5;break;case 4:e.prev=4,e.catch(1),this.showScannerError("Failed to initialize camera. Please ensure camera permissions are granted.");case 5:case"end":return e.stop()}},e,this,[[1,4]])})),function(){return h.apply(this,arguments)})},{key:"onQRCodeScanned",value:(d=(0,i.A)(l.mark(function e(t,n){var i;return l.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=1,!this.qrReader){e.next=3;break}return e.next=2,this.qrReader.stop();case 2:this.qrReader=null;case 3:return(i=document.getElementById("qr-reader-section"))&&(i.style.display="none"),e.next=4,this.processScannedData(t);case 4:e.next=6;break;case 5:e.prev=5,e.catch(1),this.showError("Failed to process QR code. Please try again."),this.resetScanner();case 6:case"end":return e.stop()}},e,this,[[1,5]])})),function(e,t){return d.apply(this,arguments)})},{key:"onQRScanError",value:function(e){e&&e.includes("No QR code found")}},{key:"processScannedData",value:(s=(0,i.A)(l.mark(function e(t){var n,i;return l.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=1,n=null,t.includes("review.html?id=")?(i=new URL(t),n=i.searchParams.get("id")):n=t.trim(),n){e.next=2;break}throw new Error("Invalid QR code format - no toilet ID found");case 2:return e.next=3,this.loadToiletInfo(n);case 3:e.next=5;break;case 4:e.prev=4,e.catch(1),this.showError("Invalid QR code. Please scan a valid toilet QR code."),this.resetScanner();case 5:case"end":return e.stop()}},e,this,[[1,4]])})),function(e){return s.apply(this,arguments)})},{key:"loadToiletInfo",value:(o=(0,i.A)(l.mark(function e(t){var n,i,r,a;return l.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById("toiletInfo")){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,n.innerHTML='\n                <div class="toilet-info__loading" role="status" aria-live="polite">\n                    <div class="loading-spinner" aria-hidden="true"></div>\n                    <p>Loading toilet information...</p>\n                </div>\n            ',n.style.display="block",e.next=2,this.toiletApiService.getToiletById(t);case 2:if(i=e.sent){e.next=3;break}throw new Error("Toilet not found");case 3:this.currentToiletId=t,this.displayToiletInfo(i),(r=document.getElementById("reviewFormSection"))&&(r.style.display="block"),e.next=5;break;case 4:e.prev=4,a=e.catch(1),n.innerHTML='\n                <div class="toilet-info__error" role="alert">\n                    <h3>Error Loading Toilet Information</h3>\n                    <p>'.concat(a.message,'</p>\n                    <button onclick="window.location.reload()" class="btn btn-primary">Try Again</button>\n                </div>\n            ');case 5:case"end":return e.stop()}},e,this,[[1,4]])})),function(e){return o.apply(this,arguments)})},{key:"displayToiletInfo",value:function(e){var t=document.getElementById("toiletInfo"),n=e.facilities&&e.facilities.length>0?e.facilities.map(function(e){return'<span class="toilet-info__facility">'.concat(e.replace(/_/g," ").replace(/\b\w/g,function(e){return e.toUpperCase()}),"</span>")}).join(""):'<span class="toilet-info__facility">No facilities listed</span>';t.innerHTML='\n            <h2 class="toilet-info__title">Toilet Information</h2>\n            <div class="toilet-info__content">\n                <div class="toilet-info__group">\n                    <h3 class="toilet-info__value">'.concat(e.name||"Unnamed Toilet",'</h3>\n                    <p class="toilet-info__value">').concat(e.location||"Location not specified",'</p>\n                </div>\n                <div class="toilet-info__group">\n                    <h4 class="toilet-info__label">Current Rating</h4>\n                    <p class="toilet-info__rating">').concat(e.averageRating?"".concat(e.averageRating.toFixed(1)," ‚≠ê"):"No ratings yet",'</p>\n                    <p class="toilet-info__value">').concat(e.totalReviews||0,' reviews</p>\n                </div>\n                <div class="toilet-info__group">\n                    <h4 class="toilet-info__label">Facilities</h4>\n                    <div class="toilet-info__facilities">').concat(n,"</div>\n                </div>\n            </div>\n        ")}},{key:"setupFormHandlers",value:function(){var e=document.getElementById("reviewForm"),t=document.getElementById("scanNewQR");e&&e.addEventListener("submit",this.handleReviewSubmit.bind(this)),t&&t.addEventListener("click",this.resetScanner.bind(this))}},{key:"handleReviewSubmit",value:(n=(0,i.A)(l.mark(function e(t){var n,i,r,a,o;return l.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),this.currentToiletId){e.next=1;break}return this.showError("No toilet selected. Please scan a QR code first."),e.abrupt("return");case 1:if(n=t.target.querySelector('button[type="submit"]'),this.setButtonLoading(n,!0),e.prev=2,r=new FormData(t.target),(a={toiletId:this.currentToiletId,rating:parseInt(r.get("rating")),cleanliness:parseInt(r.get("cleanliness")),maintenance:parseInt(r.get("maintenance")),accessibility:parseInt(r.get("accessibility")),comment:(null===(i=r.get("comments"))||void 0===i?void 0:i.trim())||""}).rating&&a.cleanliness&&a.maintenance&&a.accessibility){e.next=3;break}throw new Error("Please fill in all required rating fields");case 3:return e.next=4,this.reviewApiService.submitReview(a);case 4:this.showSuccess(),e.next=6;break;case 5:e.prev=5,o=e.catch(2),this.showError(o.message||"Failed to submit review. Please try again.");case 6:return e.prev=6,this.setButtonLoading(n,!1),e.finish(6);case 7:case"end":return e.stop()}},e,this,[[2,5,6,7]])})),function(e){return n.apply(this,arguments)})},{key:"showSuccess",value:function(){var e=document.getElementById("toiletInfo"),t=document.getElementById("reviewFormSection");e&&(e.style.display="none"),t&&(t.style.display="none");var n=document.getElementById("successMessage");n&&(n.style.display="block",this.createConfetti())}},{key:"showError",value:function(e){alert("Error: ".concat(e))}},{key:"showScannerError",value:function(e){var t=document.getElementById("qr-reader-section");t&&(t.innerHTML='\n                <div class="scanner-section__error" role="alert">\n                    <h2 class="scanner-section__title">Camera Error</h2>\n                    <p>'.concat(e,'</p>\n                    <button onclick="window.location.reload()" class="btn btn-primary">Retry</button>\n                </div>\n            '))}},{key:"resetScanner",value:function(){var e=this;this.qrReader&&(this.qrReader.stop().catch(console.error),this.qrReader=null);["toiletInfo","reviewFormSection","successMessage"].forEach(function(e){var t=document.getElementById(e);t&&(t.style.display="none")});var t=document.getElementById("reviewForm");t&&t.reset();var n=document.getElementById("qr-reader-section");n&&(n.style.display="block",n.innerHTML='\n                <h2 class="scanner-section__title">Scan QR Code</h2>\n                <div id="qr-reader" class="scanner-section__reader" role="application" aria-label="QR code scanner"></div>\n                <div class="scanner-section__instructions">\n                    <h3 class="scanner-section__instructions-title">How to Scan</h3>\n                    <p class="scanner-section__instructions-text">Point your camera at the toilet\'s QR code to begin your review.</p>\n                </div>\n            ',setTimeout(function(){return e.initializeQRScanner()},100)),this.currentToiletId=null}},{key:"createConfetti",value:function(){var e=document.getElementById("confettiContainer")||document.createElement("div");e.id="confettiContainer",e.className="confetti-container";for(var t=["#ff69b4","#ffd700","#00ff00","#ff0000","#0000ff"],n=function(){var n=document.createElement("div");n.style.cssText="\n                position: absolute;\n                width: 10px;\n                height: 10px;\n                background-color: ".concat(t[Math.floor(Math.random()*t.length)],";\n                left: ").concat(100*Math.random(),"%;\n                animation: fall ").concat(3+2*Math.random(),"s linear forwards;\n                z-index: 1000;\n            "),e.appendChild(n),setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n)},5e3)},i=0;i<50;i++)n();var r=document.getElementById("successMessage");r&&!r.contains(e)&&r.appendChild(e)}},{key:"setButtonLoading",value:function(e,t){e&&(e.disabled=t,e.textContent=t?"Submitting...":"Submit Review",t?e.classList.add("loading"):e.classList.remove("loading"))}},{key:"destroy",value:function(){this.qrReader&&(this.qrReader.stop().catch(console.error),this.qrReader=null),this.currentToiletId=null}}]);var n,o,s,d,h,f}(d.v)},718(e,t,n){n.d(t,{Sn:()=>i});var i={TOILETS:{MAP:"toilet/map",STATS:"toilet/stats",ADD_PRIVATE:"toilet/add-private",SYNC_PUBLIC:"toilet/sync-public",BY_ID:function(e){return"toilet/".concat(e)},QR_CODE:function(e){return"toilet/".concat(e,"/qr")}},REVIEWS:{SUBMIT:"review/submit",ALL:"review/all",BY_TOILET:function(e){return"review/toilet/".concat(e)},BY_ID:function(e){return"reviews/".concat(e)}},AUTH:{LOGIN:"auth/login",REGISTER:"auth/register",LOGOUT:"auth/logout",ME:"auth/me"},ADMIN:{LOGIN:"admin/login",DASHBOARD:"admin/dashboard",STATS:"admin/stats"},SYSTEM:{SLO_METRICS:"slo/metrics",CACHE_STATS:"cache/stats",CACHE_INVALIDATE:"cache/invalidate"}}}}]);
//# sourceMappingURL=81.8736585cead2af017612.js.map